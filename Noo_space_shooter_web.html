<!DOCTYPE html>
<html>
<head>
    <title>Space Shooter</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 1px solid #333;
        }
        #gameInput {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            display: none;
        }
        input {
            margin: 10px;
            padding: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="600" height="800"></canvas>
    <div id="gameInput">
        <h2>Enter your name:</h2>
        <input type="text" id="playerName" maxlength="15">
        <br>
        <span>Press Enter when done</span>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const input = document.getElementById('gameInput');
        const nameInput = document.getElementById('playerName');

        // Game constants
        const WIDTH = 600;
        const HEIGHT = 800;
        const FPS = 60;

        // Game state
        let gameState = {
            player: null,
            enemies: [],
            bullets: [],
            bossBullets: [],
            stars: [],
            powerups: [],
            hpRefills: [],
            score: 0,
            boss: null,
            gameStarted: false,
            playerName: '',
            startTime: 0,
            lastEnemySpawn: 0,
            nextPowerupTime: 0,
            nextHpRefillTime: 0,
            powerupsSpawned: 0
        };

        // Star class
        class Star {
            constructor() {
                this.size = Math.random() * 3 + 1;
                this.x = Math.random() * WIDTH;
                this.y = Math.random() * HEIGHT;
                this.speed = Math.random() * 1.5 + 0.5;
            }

            update() {
                this.y += this.speed;
                if (this.y > HEIGHT) {
                    this.y = 0;
                    this.x = Math.random() * WIDTH;
                }
            }

            draw() {
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size/2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Player class
        class Player {
            constructor() {
                this.width = 80;
                this.height = 100;
                this.x = WIDTH / 2 - this.width / 2;
                this.y = HEIGHT - this.height - 10;
                this.speed = 8;
                this.hp = 200;
                this.maxHp = 200;
                this.shootDelay = 250;
                this.lastShot = 0;
            }

            update() {
                if (keys.ArrowLeft && this.x > 0) this.x -= this.speed;
                if (keys.ArrowRight && this.x < WIDTH - this.width) this.x += this.speed;
            }

            draw() {
                // Main body
                ctx.fillStyle = 'rgb(180, 180, 180)';
                ctx.beginPath();
                ctx.moveTo(this.x + this.width/2, this.y);
                ctx.lineTo(this.x + this.width - 5, this.y + this.height/2);
                ctx.lineTo(this.x + this.width * 0.7, this.y + this.height);
                ctx.lineTo(this.x + this.width * 0.3, this.y + this.height);
                ctx.lineTo(this.x + 5, this.y + this.height/2);
                ctx.closePath();
                ctx.fill();

                // Draw health bar
                const barLength = this.width;
                const barHeight = 5;
                const fill = (this.hp / this.maxHp) * barLength;
                ctx.fillStyle = 'green';
                ctx.fillRect(this.x, this.y + this.height + 5, fill, barHeight);
                ctx.strokeStyle = 'white';
                ctx.strokeRect(this.x, this.y + this.height + 5, barLength, barHeight);
            }

            shoot() {
                const now = Date.now();
                if (now - this.lastShot > this.shootDelay) {
                    gameState.bullets.push(new Bullet(this.x + this.width/2, this.y));
                    this.lastShot = now;
                }
            }
        }

        // Enemy class
        class Enemy {
            constructor() {
                this.width = 40;
                this.height = 30;
                this.x = Math.random() * (WIDTH - this.width);
                this.y = -this.height;
                this.speedY = (Math.random() * 5 + 3) * 0.5;
                this.speedX = (Math.random() * 6 - 3) * 0.5;
                this.hp = 3;
            }

            update() {
                this.y += this.speedY;
                this.x += this.speedX;
            }

            draw() {
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.moveTo(this.x + this.width/2, this.y);
                ctx.lineTo(this.x + this.width, this.y + this.height/2);
                ctx.lineTo(this.x + this.width/2, this.y + this.height);
                ctx.lineTo(this.x, this.y + this.height/2);
                ctx.closePath();
                ctx.fill();

                // Health bar
                const barLength = this.width;
                const barHeight = 3;
                const fill = (this.hp / 3) * barLength;
                ctx.fillStyle = 'green';
                ctx.fillRect(this.x, this.y - barHeight - 2, fill, barHeight);
                ctx.strokeStyle = 'white';
                ctx.strokeRect(this.x, this.y - barHeight - 2, barLength, barHeight);
            }
        }

        // Boss class
        class Boss {
            constructor() {
                this.width = 120;
                this.height = 80;
                this.x = WIDTH/2 - this.width/2;
                this.y = 20;
                this.hp = 50;
                this.maxHp = 50;
                this.speedX = 3;
                this.shootDelay = 1000;
                this.lastShot = 0;
            }

            update() {
                this.x += this.speedX;
                if (this.x + this.width > WIDTH || this.x < 0) {
                    this.speedX = -this.speedX;
                }

                const now = Date.now();
                if (now - this.lastShot > this.shootDelay) {
                    gameState.bossBullets.push(new BossBullet(this.x + this.width/2, this.y + this.height));
                    this.lastShot = now;
                }
            }

            draw() {
                ctx.fillStyle = 'red';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.strokeStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + this.height/2);
                ctx.lineTo(this.x + this.width, this.y + this.height/2);
                ctx.stroke();

                // Health bar
                const barLength = this.width;
                const barHeight = 5;
                const fill = (this.hp / this.maxHp) * barLength;
                ctx.fillStyle = 'green';
                ctx.fillRect(this.x, this.y - barHeight - 2, fill, barHeight);
                ctx.strokeStyle = 'white';
                ctx.strokeRect(this.x, this.y - barHeight - 2, barLength, barHeight);
            }
        }

        // Bullet classes
        class Bullet {
            constructor(x, y) {
                this.width = 5;
                this.height = 10;
                this.x = x - this.width/2;
                this.y = y;
                this.speed = 10;
            }

            update() {
                this.y -= this.speed;
            }

            draw() {
                ctx.fillStyle = 'yellow';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        class BossBullet {
            constructor(x, y) {
                this.radius = 5;
                this.x = x;
                this.y = y;
                this.speed = 5;
            }

            update() {
                this.y += this.speed;
            }

            draw() {
                ctx.fillStyle = 'yellow';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Power-up classes
        class PowerUp {
            constructor() {
                this.width = 30;
                this.height = 30;
                this.x = Math.random() * (WIDTH - this.width);
                this.y = -this.height;
                this.speed = 3;
            }

            update() {
                this.y += this.speed;
            }

            draw() {
                ctx.fillStyle = 'green';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        class HPRefill {
            constructor() {
                this.width = 30;
                this.height = 30;
                this.x = Math.random() * (WIDTH - this.width);
                this.y = -this.height;
                this.speed = 3;
            }

            update() {
                this.y += this.speed;
            }

            draw() {
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.arc(this.x + 10, this.y + 10, 10, 0, Math.PI * 2);
                ctx.arc(this.x + 20, this.y + 10, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + 15);
                ctx.lineTo(this.x + 30, this.y + 15);
                ctx.lineTo(this.x + 15, this.y + 30);
                ctx.closePath();
                ctx.fill();
            }
        }

        // Keyboard handling
        const keys = {
            ArrowLeft: false,
            ArrowRight: false,
            Space: false
        };

        document.addEventListener('keydown', (e) => {
            if (keys.hasOwnProperty(e.code)) {
                keys[e.code] = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (keys.hasOwnProperty(e.code)) {
                keys[e.code] = false;
            }
        });

        // Game state functions
        function initGame() {
            gameState = {
                player: new Player(),
                enemies: [],
                bullets: [],
                bossBullets: [],
                stars: [],
                powerups: [],
                hpRefills: [],
                score: 0,
                boss: null,
                gameStarted: true,
                startTime: Date.now(),
                lastEnemySpawn: Date.now(),
                nextPowerupTime: Date.now() + 5000,
                nextHpRefillTime: Date.now() + 10000,
                powerupsSpawned: 0
            };

            // Initialize stars
            for (let i = 0; i < 50; i++) {
                gameState.stars.push(new Star());
            }
        }

        function showStartScreen() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            
            ctx.fillStyle = 'yellow';
            ctx.font = '64px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('SPACE SHOOTER', WIDTH/2, HEIGHT/4);
            
            ctx.fillStyle = 'white';
            ctx.font = '22px Arial';
            ctx.fillText('Arrow keys move, Space to fire', WIDTH/2, HEIGHT/2);
            ctx.font = '18px Arial';
            ctx.fillText('Catch green boxes to shoot faster!', WIDTH/2, HEIGHT/2 + 30);
            ctx.fillText('Avoid enemies: each hit or enemy pass reduces HP', WIDTH/2, HEIGHT/2 + 60);
            ctx.fillText('Survive 50 seconds and defeat the boss to win!', WIDTH/2, HEIGHT/2 + 90);
            ctx.fillText('Press any key to start', WIDTH/2, HEIGHT * 3/4);
        }

        function getPlayerName() {
            return new Promise((resolve) => {
                input.style.display = 'block';
                canvas.style.display = 'none';
                
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && nameInput.value.trim() !== '') {
                        input.style.display = 'none';
                        canvas.style.display = 'block';
                        resolve(nameInput.value.trim());
                    }
                });
            });
        }

        // Game loop
        function update() {
            const now = Date.now();
            const gameTime = now - gameState.startTime;

            // Update stars
            gameState.stars.forEach(star => star.update());

            // Player update
            gameState.player.update();
            if (keys.Space) {
                gameState.player.shoot();
            }

            // Spawn boss at 50 seconds
            if (!gameState.boss && gameTime >= 50000) {
                gameState.boss = new Boss();
            }

            // Update boss
            if (gameState.boss) {
                gameState.boss.update();
            }

            // Spawn enemies
            if (!gameState.boss && now - gameState.lastEnemySpawn > 2000) {
                const enemy = new Enemy();
                if (gameTime < 10000) {
                    enemy.hp = 1;
                } else if (gameTime < 20000) {
                    enemy.hp = 2;
                }
                gameState.enemies.push(enemy);
                gameState.lastEnemySpawn = now;
            }

            // Update game objects
            gameState.enemies.forEach(enemy =>